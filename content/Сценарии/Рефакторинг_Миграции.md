# 5.2. Playbook: рефакторинг/миграции

- **Last reviewed**: 2026-01-15
- **Уровень**: Advanced

## Когда применять

- нужно улучшить структуру кода без изменения поведения
- миграции/массовые переименования/декомпозиция

## Input

- цель и границы (что не меняем)
- список затрагиваемых модулей
- требования к тестам/проверкам

## Output

- минимальный безопасный рефакторинг
- тесты/проверки
- список рисков и как откатывать

## Process

1. Plan first: шаги + файлы + риски + тест‑план.
2. Разбить на маленькие батчи.
3. После каждого батча — verify.

## Safety

- не трогать публичный API без Spec/AC
- изменения в “зонах риска” только с ревью (auth/db/crypto)

## Template prompt

> Цель: … (рефакторинг, не меняя поведения)  
> Ограничения: минимальный diff, не трогать публичный API, тесты обязательны.  
> Дай план + батчи + тест‑план. STOP‑POINT после плана.

## Done criteria

- тесты зелёные
- поведение не изменилось (по AC/инвариантам)

## Pitfalls

- “рефакторинг” меняет бизнес‑логику
- батчи слишком большие

